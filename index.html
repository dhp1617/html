<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@1.7.2/aframe/build/aframe-ar.min.js"></script>
    
<script>
    navigator.mediaDevices.getUserMedia({ video: true })
    .then((stream) => { console.log("Camera access granted"); })
    .catch((err) => { console.error("Camera access denied:", err); });
</script>
    <script>
        function updateVisibility() {
            navigator.geolocation.getCurrentPosition(position => {
                let userLat = position.coords.latitude;
                let userLon = position.coords.longitude;
                let userAlt = position.coords.altitude; // Get altitude
                let targetLat = 10.939258; // Example GPS latitude (change to your location)
                let targetLon = 76.743131;  
                let minAlt = 4; // Min height for 2nd floor (~4m)
                let maxAlt = 6; // Max height for 2nd floor (~6m)

                let distance = getDistance(userLat, userLon, targetLat, targetLon);
                let textEntity = document.getElementById('floating-text');

                // Show only if within 10m of target and altitude is 2nd-floor range
                textEntity.setAttribute('visible', distance < 10 && userAlt >= minAlt && userAlt <= maxAlt);
            }, error => {
                console.error("Error getting location:", error);
            }, { enableHighAccuracy: true });
        }

        function getDistance(lat1, lon1, lat2, lon2) {
            let R = 6371e3; // Earth radius in meters
            let φ1 = lat1 * Math.PI / 180;
            let φ2 = lat2 * Math.PI / 180;
            let Δφ = (lat2 - lat1) * Math.PI / 180;
            let Δλ = (lon2 - lon1) * Math.PI / 180;
            let a = Math.sin(Δφ/2) * Math.sin(Δφ/2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ/2) * Math.sin(Δλ/2);
            let c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        setInterval(updateVisibility, 3000); // Update visibility every 3 seconds
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
        <a-entity camera></a-entity>

        <!-- Floating 3D Text (Appears Only at 2nd Floor) -->
        <a-text id="floating-text" value="Welcome to AR!" position="0 8 0" rotation="0 180 0" scale="30 30 30" color="red"></a-text>
        
        <!-- Occlusion Object (Invisible Box Representing a Building) -->
        <a-box position="0 1 -3" depth="1" height="2" width="3" material="opacity: 0.0;"></a-box>
    </a-scene>
</body>
</html>
