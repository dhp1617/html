<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Tour Guide - Guaranteed Visibility</title>
  <!-- Load libraries from reliable CDN -->
  <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1.2.0/dist/aframe-master.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #ar-status {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px;
      font-family: Arial;
      z-index: 10000;
    }
  </style>
</head>
<body>
  <div id="ar-status">Initializing AR experience...</div>

  <!-- AR Scene with Marker Fallback -->
  <a-scene 
    vr-mode-ui="enabled: false"
    embedded
    arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: true;"
    renderer="logarithmicDepthBuffer: true;"
  >
    <!-- Camera Setup -->
    <a-camera gps-camera rotation-reader></a-camera>

    <!-- ===== PRIMARY LANDMARK (GPS) ===== -->
    <a-entity 
      id="main-landmark"
      gps-entity-place="latitude: 10.939230; longitude: 76.743130"
      visible="true"
    >
      <!-- Giant 3D Arrow (200m tall) -->
      <a-cone 
        color="#FF3355" 
        radius-bottom="100" 
        radius-top="5" 
        height="200"
        position="0 100 0"
        material="transparent: true; opacity: 0.9"
      ></a-cone>
      
      <!-- Pulsing Light Beacon -->
      <a-light 
        type="point" 
        color="yellow" 
        intensity="2" 
        position="0 200 0"
        animation="property: light.intensity; to: 5; dur: 1000; loop: true; dir: alternate"
      ></a-light>
      
      <!-- Floating Label -->
      <a-text 
        value="TOUR POINT" 
        color="white" 
        position="0 250 0" 
        scale="80 80 80"
        align="center"
      ></a-text>
    </a-entity>

    <!-- ===== FALLBACK MARKER (If GPS fails) ===== -->
    <a-marker preset="hiro">
      <a-box position="0 0.5 0" color="blue" scale="1 1 1"></a-box>
      <a-text value="GPS Not Working - Use Marker" position="0 1.5 0" color="black"></a-text>
    </a-marker>
  </a-scene>

  <script>
    const statusEl = document.getElementById('ar-status');
    const landmark = document.getElementById('main-landmark');

    // ===== 1. Verify AR.js Loaded =====
    if (!window.ARjs || !window.AFRAME) {
      statusEl.innerHTML = "CRITICAL: AR libraries failed to load. Refresh page.";
      throw new Error("AR libraries missing");
    }

    // ===== 2. Camera Ready Check =====
    const scene = document.querySelector('a-scene');
    scene.addEventListener('arjs-video-loaded', () => {
      statusEl.innerHTML += "<br>‚úÖ Camera feed active";
    });

    // ===== 3. GPS Tracking =====
    if (navigator.geolocation) {
      statusEl.innerHTML += "<br>‚åõ Acquiring GPS signal...";
      
      const gpsOptions = {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 15000
      };

      const watchId = navigator.geolocation.watchPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const acc = pos.coords.accuracy;
          
          statusEl.innerHTML = `
            <strong>AR LANDMARK ACTIVE</strong><br>
            üìç Your location: ${lat.toFixed(6)}, ${lng.toFixed(6)}<br>
            üéØ Target: 10.939230, 76.743130<br>
            üìè GPS Accuracy: ¬±${acc.toFixed(1)} meters<br>
            <small>Look around - giant red arrow should be visible</small>
          `;

          // Force object visibility
          landmark.setAttribute('visible', 'true');
        },
        (err) => {
          statusEl.innerHTML = `‚ö†Ô∏è GPS Error: ${err.message}<br>
            <strong>Try scanning this Hiro marker instead:</strong>
            <img src="https://arjs-cdn.glitch.me/static/images/hiro.png" width="100">`;
          
          // Show marker-based content if GPS fails
          document.querySelector('a-marker').setAttribute('visible', 'true');
        },
        gpsOptions
      );
    } else {
      statusEl.innerHTML = "‚ö†Ô∏è Geolocation not supported - Using marker fallback";
      document.querySelector('a-marker').setAttribute('visible', 'true');
    }
  </script>
</body>
</html>
