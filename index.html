<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Tour Guide - Visible Box</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-gps-entity-place.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #debug-info {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      z-index: 10000;
      font-family: Arial;
    }
  </style>
</head>
<body>
  <div id="debug-info">Loading AR...</div>
  
  <a-scene 
    vr-mode-ui="enabled: false" 
    embedded 
    arjs="sourceType: webcam; debugUIEnabled: true;"
    renderer="logarithmicDepthBuffer: true;"
  >
    <!-- Camera setup -->
    <a-entity camera></a-entity>

    <!-- BIG BOX at your coordinates -->
    <a-entity
      id="target-box"
      gps-entity-place="latitude: 10.939230; longitude: 76.743130"
      scale="1 1 1"
    >
      <a-box 
        color="red" 
        scale="20 20 20" 
        position="0 10 0"
        material="transparent: false; opacity: 0.8"
      ></a-box>
      <a-text 
        value="Look Here!" 
        color="red" 
        position="0 25 0" 
        scale="10 10 10"
      ></a-text>
    </a-entity>
  </a-scene>

  <script>
    const debugInfo = document.getElementById('debug-info');
    const targetBox = document.getElementById('target-box');
    let userPosition = null;

    // Debugging: Check if AR.js loaded properly
    if (!window.ARjs || !window.AFRAME) {
      debugInfo.innerHTML = "Error: AR.js or A-Frame not loaded!";
    }

    // Get user's location
    if (navigator.geolocation) {
      navigator.geolocation.watchPosition(
        (position) => {
          userPosition = position;
          const userLat = position.coords.latitude;
          const userLng = position.coords.longitude;
          const boxLat = 10.939230;
          const boxLng = 76.743130;
          
          const distance = calculateDistance(userLat, userLng, boxLat, boxLng);
          debugInfo.innerHTML = `
            Your position: ${userLat.toFixed(6)}, ${userLng.toFixed(6)}<br>
            Distance to box: ${distance.toFixed(1)}m<br>
            Accuracy: ±${position.coords.accuracy.toFixed(1)}m<br>
            Camera: ${document.querySelector('a-scene').systems.arjs.isSourceReady ? 'Ready' : 'Loading...'}
          `;

          // Make box more visible when close
          if (distance < 100) {
            targetBox.setAttribute('visible', 'true');
            targetBox.setAttribute('scale', '1 1 1');
          } else {
            targetBox.setAttribute('scale', '0.1 0.1 0.1'); // Shrink when far
          }
        },
        (error) => {
          debugInfo.innerHTML = `Geolocation error: ${error.message}`;
        },
        {
          enableHighAccuracy: true,
          maximumAge: 30000,
          timeout: 27000
        }
      );
    } else {
      debugInfo.innerHTML = "Geolocation not supported by your browser";
    }

    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371000; // Earth radius in meters
      const φ1 = lat1 * Math.PI / 180;
      const φ2 = lat2 * Math.PI / 180;
      const Δφ = (lat2 - lat1) * Math.PI / 180;
      const Δλ = (lon2 - lon1) * Math.PI / 180;

      const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

      return R * c;
    }
  </script>
</body>
</html>
